#!/usr/bin/env python

import io
import math
import optparse
import os
import sys

pwd = os.path.dirname(__file__)
root = os.path.join(pwd, '..')
sys.path.append(root)

from skadi import replay
from skadi.io import protobuf as io_p
from skadi.meta import demo

option_parser = optparse.OptionParser()
(options, args) = option_parser.parse_args()

for arg in args:
  print '> parsing {0}'.format(os.path.basename(arg))

  f_io = io.open(os.path.join(root, arg), 'r+b')
  d_io = io_p.Demo.wrapping(f_io)
  demo = demo.parse(d_io)

  _replay = replay.construct(demo, d_io)

  for tick in list(reversed(demo._norm_keys)):
    #print 'snapshot: {0}'.format(tick)
    _replay.snapshot(tick)